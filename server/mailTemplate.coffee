@getMail = (text) ->
	check text, String

	text = text.replace /\n/ig, "<br>"
	return '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><!doctype html><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>simply</title><style type="text/css">.ReadMsgBody{width: 100%;background-color: #ffffff;}.ExternalClass{width: 100%;background-color: #ffffff;}body{width: 100%;background-color: #ffffff;margin:0;padding:0;-webkit-font-smoothing: antialiased;font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;}body,p{font-size:14px;line-height:1.4em;}table{border-collapse: collapse;mso-table-lspace:0pt;mso-table-rspace:0pt;}table td{border-collapse:collapse;}.wrapper{box-shadow: 0px 0px 30px #d4d4d4;}img{border:0;padding:0;margin:0;width:auto;height:auto;height: 100;}.ExternalClass .full img{width:325px;}span.yshortcuts{color:#000;background-color:none;border:none;}span.yshortcuts:hover,span.yshortcuts:active,span.yshortcuts:focus{color:#000;background-color:none;border:none;}/** The autofit killer prevents the Gmail app* from collapsing the email.*/.autofitkiller{min-width:650px !important;}/** Padded elements * Change the amount of padding based on your design* AND remember to change the width of the parent <td> * elements below */.padded{padding:0 20px 0 20px;}.padded.left{padding:0 10px 0 20px;}.padded.right{padding:0 20px 0 10px;}/** Responsive styles for devices smaller than 641px* The body[yahoo] selector is a fix for Yahoo Mail */@media only screen and (max-width: 641px){body[yahoo],p{font-size:16px;line-height:1.4em;}body[yahoo] .deviceWidth{width:94%!important;min-width:320px;}body[yahoo] .wrapper{box-shadow:none;}body[yahoo] .center{text-align: center !important;}body[yahoo] .full{display:block;width:100%;max-width:100% !important;}body[yahoo] .full img{max-width:100% !important;width:100% !important;}body[yahoo] .full:first-child{margin-bottom:10px;}/** We no longer need the autofit killer* Kill the autofit killer*/body[yahoo] .autofitkiller{display:none;}/** Remove the padding from padded elements */body[yahoo] .padded{padding:0 !important;}body[yahoo] .padded p{padding:20px !important;}/** Utility Classes*//* * Hide on mobile*/.hide{display:none;}}</td></style></head><body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" yahoo="fix" style="width: 100%;background-color: #ffffff;margin: 0;padding: 0;-webkit-font-smoothing: antialiased;font-family: &quot;HelveticaNeue-Light&quot;, &quot;Helvetica Neue Light&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;Lucida Grande&quot;, sans-serif;font-size: 14px;line-height: 1.4em;"><table width="100%" border="0" cellpadding="0" cellspacing="0" align="center" style="border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;"><tr><td width="100%" valign="top" bgcolor="#ffffff" style="padding-top: 20px;border-collapse: collapse;"><table width="650" border="0" cellpadding="0" cellspacing="0" align="center" class="wrapper deviceWidth" style="border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;box-shadow: 0px 0px 30px #d4d4d4;"><tr><td width="100%" style="border-collapse: collapse;"><table width="650" border="0" cellpadding="0" cellspacing="0" align="center" class="deviceWidth" bgcolor="#32A8CE" style="border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;"><tr><td width="100%" bgcolor="#32A8CE" style="border-collapse: collapse;"><table border="0" cellpadding="0" cellspacing="0" align="center" class="deviceWidth" style="border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;"><tr><td style="padding: 5px;border-collapse: collapse;" width="100%" class="center logo"><a href="' + Meteor.absoluteUrl() + '"><img src="http://simplyhomework.nl/images/simplyLogo.gif" width="310" height="50" alt="" border="0" style="height: 50px;border: 0;padding: 0;margin: 0;width: auto;"></a></td></tr></table></td></tr></table><table width="650" class="deviceWidth" border="0" cellpadding="0" cellspacing="0" align="center" bgcolor="#FFFFFF" style="border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;"><tr><td valign="top" height="10" style="padding: 0;border-collapse: collapse;" bgcolor="#ffffff"></td></tr></table><table width="650" class="deviceWidth" border="0" cellpadding="0" cellspacing="0" align="center" bgcolor="#eeeeed" style="border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;"><tr><td valign="top" bgcolor="#ffffff" class="full padded" style="border-collapse: collapse;padding: 0 20px 0 20px;"><p style="mso-table-lspace: 0;mso-table-rspace: 0;padding: 0px;margin: 0;font-size: 14px;line-height: 1.4em;">' + text + '</p></td></tr></table><table width="650" class="deviceWidth" border="0" cellpadding="0" cellspacing="0" align="center" bgcolor="#FFFFFF" style="border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;"><tr><td valign="top" height="10" style="padding: 0;border-collapse: collapse;" bgcolor="#ffffff"></td></tr></table><table width="650" border="0" cellpadding="0" cellspacing="0" align="center" class="deviceWidth" bgcolor="#32A8CE" style="border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;"><tr><td bgcolor="#32A8CE" style="border-collapse: collapse;"><table border="0" cellpadding="0" cellspacing="0" align="center" style="border-collapse: collapse;mso-table-lspace: 0pt;mso-table-rspace: 0pt;"><tr><td class="center" width="100%" style="font-size: 9px;color: #FFFFFF;text-align: right;line-height: 20px;vertical-align: middle;padding: 10px 20px 10px 20px;font-style: normal;border-collapse: collapse;"><span href="#" style="text-decoration: none;font-size: 12px;color: #FFFFFF;"><b>simply.</b></span></td></tr></table></td></tr></table></td></tr></table></td></tr></table></body></html>'

@sendMail = (user, subject, text) ->
	check subject, String
	check text, String

	mail = if _.isString(user) then user else user.emails[0].address

	Email.send
		from: "simplyHomework <hello@simplyApps.nl>"
		to: mail
		subject: subject
		html: getMail text